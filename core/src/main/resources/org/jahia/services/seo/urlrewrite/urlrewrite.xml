<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE urlrewrite PUBLIC "-//tuckey.org//DTD UrlRewrite 3.2//EN"
        "http://tuckey.org/res/dtds/urlrewrite3.2.dtd">

<urlrewrite>

    <!-- Block direct access -->
    <rule enabled="true">
        <name>Allow access</name>
        <note>Allow access to the some resources</note>
        <condition type="attribute" name="javax.servlet.forward.request_uri" operator="equal">^$</condition>
        <from>^/modules/.*/FlexPaper\.properties$</from>
        <set type="request" name="jahiaResourceAccessGranted">yes</set>
    </rule>
    <rule enabled="true">
        <name>Block direct access</name>
        <note>Restricts direct access to the resources</note>
        <condition type="attribute" name="javax.servlet.forward.request_uri" operator="equal">^$</condition>
        <condition type="attribute" name="jahiaResourceAccessGranted" operator="equal">^$</condition>
        <from>^/(LICENSE|modules/.*/META-INF/.*|modules/.*/WEB-INF/.*|modules/.*/mails/.*|modules/.*\.cnd|modules/.*\.drl|modules/.*\.dsl|modules/.*\.properties)$</from>
        <set type="status">404</set>
        <set type="request" name="UrlRewriteFilter.sendError">404</set>
        <to>null</to>        
    </rule>
    <!-- end of block direct access -->
    
    <rule enabled="true">
        <name>OSGi Web console access</name>
        <note>Allow access via /tools/osgi/* path only to the OSGi Web console</note>
        <condition type="attribute" name="javax.servlet.forward.request_uri" operator="equal">^$</condition>
        <condition type="request-uri" operator="notequal">^(/[\p{Alnum}\-_]*)?/tools/osgi/console(/.*)?</condition>
        <from>^/tools/osgi/.*$</from>
        <set type="status">404</set>
        <set type="request" name="UrlRewriteFilter.sendError">404</set>
        <to>null</to>        
    </rule>
    
    <!-- GWT resources-->
    <rule>
        <note>GWT CKEditor resources</note>
        <from>^/gwt/(.*)/ckeditor/(.*)$</from>
        <to>/modules/assets/javascript/ckeditor/$2</to>
    </rule>
    <rule>
        <note>GWT CSS</note>
        <from>^/gwt/org\.(.*)/(.*)\.css$</from>
        <to>/gwt/resources/$2.css</to>
    </rule>
    <rule>
        <note>GWT images</note>
        <from>^/gwt/org\.(.*)/images/(.*)$</from>
        <to>/gwt/resources/images/$2</to>
    </rule>
    <rule>
        <note>GWT CSS images</note>
        <from>^/gwt/resources/css/images/(.*)$</from>
        <to>/gwt/resources/images/$1</to>
    </rule>
    <rule>
        <note>GWT clear.gif image</note>
        <from>^/gwt/org\.(.*)/clear.gif(.*)?$</from>
        <to>/gwt/resources/clear.gif$2</to>
    </rule>
    <!-- end of GWT resources-->

    <!-- Jahia tools -->
    <rule enabled="true">
        <name>Jahia tools</name>
        <note>Redirects to Jahia Tools overview page</note>
        <from>^/tools(/)?$</from>
        <to type="redirect">%{context-path}/tools/index.jsp</to>
    </rule>
    
    <!-- Jahia Administration -->
    <rule enabled="true">
        <name>Jahia Administration</name>
        <note>Redirects to new Jahia Server Administration page</note>
        <from>^/administration(/)?$</from>
        <to type="redirect">%{context-path}/welcome/adminmode</to>
    </rule>
    
</urlrewrite>