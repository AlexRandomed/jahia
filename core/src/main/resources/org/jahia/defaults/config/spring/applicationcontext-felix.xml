<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="felixFileInstallConfig" class="org.springframework.beans.factory.config.PropertiesFactoryBean" depends-on="settingsBean">
        <property name="properties">
            <props value-type="java.lang.String">
                <prop key="felix.fileinstall.dir">#{settingsBean.jahiaModulesDiskPath}</prop>
                <prop key="felix.fileinstall.filter">.*\.(jar|cfg)</prop>
                <prop key="felix.fileinstall.poll">${jahia.modules.fileinstall.poll:2000}</prop>
                <prop key="felix.fileinstall.start.level">90</prop>
                <prop key="felix.fileinstall.active.level">90</prop>
                <prop key="felix.fileinstall.log.level">3</prop>
                <prop key="felix.fileinstall.bundles.new.start">${jahia.modules.fileinstall.bundles.new.start:true}</prop>
                <prop key="felix.fileinstall.noInitialDelay">true</prop>
                <prop key="felix.fileinstall.enableConfigSave">false</prop>
            </props>
        </property>
    </bean>

    <bean name="combinedFelixProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean" depends-on="settingsBean">
        <property name="ignoreResourceNotFound" value="true"/>
        <property name="properties">
            <props value-type="java.lang.String">
                <prop key="gosh.args">--nointeractive -sc telnetd --port=${felix.gogo.shell.telnet.port:-1} start</prop>
                
                <prop key="felix.cache.bufsize">65536</prop>
                <prop key="felix.log.level">1</prop>

                <prop key="obr.repository.url">http://felix.apache.org/obr/releases.xml</prop>
                
                <prop key="org.osgi.framework.bootdelegation">com.yourkit.*</prop>
                <prop key="org.osgi.framework.bundle.parent">framework</prop>
                <prop key="org.osgi.framework.startlevel.beginning">2</prop>
                <prop key="org.osgi.framework.storage">#{settingsBean.jahiaVarDiskPath}/bundles-deployed</prop>
                <prop key="org.osgi.framework.storage.clean">none</prop>
                <prop key="org.apache.felix.http.shared_servlet_context_attributes">true</prop>
                
                <prop key="felix.webconsole.manager.root">/console</prop>
            </props>
        </property>
        <property name="locations">
            <list>
                <value>classpath*:org/jahia/defaults/config/properties/felix-framework*.properties</value>
                <value>/WEB-INF/etc/config/felix-framework.properties</value>
                <value>classpath*:org/jahia/config/felix-framework*.properties</value>
                <value>classpath*:jahia/felix-framework*.properties</value>
            </list>
        </property>
    </bean>

    <bean id="felixProperties" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <!-- Effective Felix properties: combined (defaults + configured in files) properties
            are overridden with the system properties, having "jahiaConfig." prefix -->
        <property name="propertiesArray">
            <list>
                <ref bean="combinedFelixProperties"/>
                <ref bean="jahiaSystemProperties"/>
            </list>
        </property>
    </bean>
</beans>