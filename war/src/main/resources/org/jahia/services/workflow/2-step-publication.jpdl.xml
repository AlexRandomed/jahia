<?xml version="1.0" encoding="UTF-8"?>

<process key="2-step-publication" name="2 Step Publication Process" xmlns="http://jbpm.org/4.3/jpdl">
    <start form="jnt:simpleWorkflow" g="33,307,80,40" name="start">
        <transition to="lock"/>
    </start>

    <custom class="org.jahia.services.workflow.jbpm.custom.Lock" g="119,311,80,40" name="lock">
        <transition to="first review"/>
    </custom>

    <task form="jnt:simpleWorkflow" g="243,310,80,40" name="first review">
        <assignment-handler class="org.jahia.services.workflow.jbpm.JBPMTaskAssignmentListener"/>
        <transition g="-18,-17" name="accept" to="final review"/>
        <transition g="133,-16" name="reject" to="unlock"/>
        <transition g="-55,-8" name="correction needed" to="unlock for correction"/>
    </task>

    <task form="jnt:simpleWorkflow" g="370,306,80,40" name="final review">
        <assignment-handler class="org.jahia.services.workflow.jbpm.JBPMTaskAssignmentListener"/>
        <transition g="-23,-19" name="publish" to="publish"/>
        <transition g="-30,3" name="reject" to="unlock"/>
        <transition g="-34,-15" name="correction needed" to="unlock for correction"/>
    </task>

    <custom class="org.jahia.services.workflow.jbpm.custom.Unlock" g="458,370,80,40" name="unlock">
        <transition to="end"/>
    </custom>

    <custom class="org.jahia.services.workflow.jbpm.custom.Publish" g="655,289,80,40" name="publish">
        <transition g="-2,-22" name="to end" to="end"/>
    </custom>

    <end g="916,272,80,40" name="end"/>

    <custom class="org.jahia.services.workflow.jbpm.custom.Unlock" g="220,470,133,39" name="unlock for correction">
        <transition to="finish correction"/>
    </custom>

    <task form="jnt:simpleWorkflow" g="104,205,116,39" name="finish correction">
        <assignment-handler class="org.jahia.services.workflow.jbpm.JBPMTaskAssignmentListener"/>
        <transition g="-45,-11" name="finished" to="lock"/>
    </task>
</process>