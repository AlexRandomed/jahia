<?xml version="1.0" encoding="UTF-8"?>


<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

    <bean id="performanceInterceptor" class="org.jahia.spring.aop.interceptor.SilentJamonPerformanceMonitorInterceptor">
        <property name="useDynamicLogger"><value>false</value></property>
    </bean>
    
    <!-- Transaction template for Managers, from:
         http://blog.exis.com/colin/archives/2004/07/31/concise-transaction-definitions-spring-11/ -->
   <bean id="txProxyTemplate" abstract="true"
       class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean">
       <property name="transactionManager" ref="transactionManager" />
       <property name="frozen" value="true" />
       <property name="optimize" value="true" />
       <property name="proxyTargetClass" value="true" />
       <property name="transactionAttributes">
           <props>
               <prop key="*">PROPAGATION_SUPPORTS,+ObjectRetrievalFailureException</prop>
               <!--<prop key="save*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="create*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="backup*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="delete*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="remove*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="update*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="acquire*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="release*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="purge*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="activate*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="change*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <prop key="retrieve*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>
               <prop key="getLogs*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>
               <!--<prop key="revoke*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="put*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="store*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="grant*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="renew*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
               <!--<prop key="add*">PROPAGATION_REQUIRED,+ObjectRetrievalFailureException</prop>-->
           </props>
       </property>
       <!-- comment the following to de-activate JAMon monitoring -->
        <property name="preInterceptors">
            <list>
                <ref bean="performanceInterceptor"/>
            </list>
        </property>
   </bean>

    <bean id="org.jahia.hibernate.manager.JahiaSitePropertyManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaSitePropertyManager">
                <property name="jahiaSitePropertyDAO" ref="jahiaSitePropertyDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaContainerStructureManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaContainerStructureManager">
                <property name="jahiaContainerStructureDAO" ref="jahiaContainerStructureDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaFieldsDataManager" parent="txProxyTemplate" depends-on="JahiaCacheService">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaFieldsDataManager">
                <property name="jahiaFieldsDataDAO" ref="jahiaFieldsDataDAO" />
                <property name="jahiaFieldsDefinitionDAO" ref="jahiaFieldsDefinitionDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
                <property name="jahiaObjectDAO" ref="jahiaObjectDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaFieldsDefinitionManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaFieldsDefinitionManager">
                <property name="jahiaFieldsDefinitionDAO" ref="jahiaFieldsDefinitionDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaPagesManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaPagesManager">
                <property name="jahiaFieldsDataDAO" ref="jahiaFieldsDataDAO" />
                <property name="jahiaObjectDAO" ref="jahiaObjectDAO" />
                <property name="jahiaWorkflowDAO" ref="jahiaWorkflowDAO" />
                <property name="groupManager" ref="org.jahia.hibernate.manager.JahiaGroupManager" />
                <property name="jahiaPagesDAO" ref="jahiaPagesDAO" />
                <property name="jahiaPagesDefinitionDAO" ref="jahiaPagesDefinitionDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaPagesUsersPropManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaPagesUsersPropManager">
                <property name="jahiaPagesUsersPropDAO" ref="jahiaPagesUsersPropDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>


    <bean id="org.jahia.hibernate.manager.JahiaTemplateManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaTemplateManager">
                <property name="jahiaPagesDefinitionDAO" ref="jahiaPagesDefinitionDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaLinkManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaLinkManager">
                <property name="jahiaLinkDAO" ref="jahiaLinkDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaGroupManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaGroupManager">
                <property name="jahiaGroupAccessDAO" ref="jahiaGroupAccessDAO" />
                <property name="jahiaGroupDAO" ref="jahiaGroupDAO" />
                <property name="jahiaUserDAO" ref="jahiaUserDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
                <property name="preloadGroupMembers" value="true"/>
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaUserManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaUserManager">
                <property name="jahiaUserDAO" ref="jahiaUserDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaLockManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaLockManager">
                <property name="jahiaLockDAO" ref="jahiaLockDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaObjectManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaObjectManager">
                <property name="jahiaObjectDAO" ref="jahiaObjectDAO" />
                <property name="cacheService" ref="JahiaCacheService" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaResourceManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaResourceManager">
                <property name="jahiaResourceDAO" ref="jahiaResourceDAO" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaLanguagesStatesManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaLanguagesStatesManager">
                <property name="jahiaLanguagesStatesDAO" ref="jahiaLanguagesStatesDAO" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaBigTextDataManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaBigTextDataManager">
                <property name="jahiaBigTextDataDAO" ref="jahiaBigTextDataDAO" />
            </bean>
        </property>
    </bean>
    <bean id="org.jahia.hibernate.manager.JahiaServerPropertiesManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaServerPropertiesManager">
                <property name="jahiaServerPropertiesDAO" ref="jahiaServerPropertiesDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.operations.PageGeneratorQueue" class="org.jahia.operations.PageGeneratorQueue">
        <constructor-arg index="0" ref="settingsBean" />
    </bean>
    
    <bean id="org.jahia.hibernate.manager.JahiaPasswordPolicyManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaPasswordPolicyManager">
                <property name="jahiaPasswordPolicyDAO" ref="jahiaPasswordPolicyDAO" />
            </bean>
        </property>
    </bean>
    
    <bean id="org.jahia.hibernate.manager.JahiaVersionManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaVersionManager">
                <property name="jahiaVersionDao" ref="jahiaVersionDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaInstalledPatchManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaInstalledPatchManager">
                <property name="jahiaInstalledPatchDao" ref="jahiaInstalledPatchDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.JahiaFieldXRefManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.JahiaFieldXRefManager">
                <property name="jahiaFieldXRefDAO" ref="jahiaFieldXRefDAO" />
            </bean>
        </property>
    </bean>

    <bean id="org.jahia.hibernate.manager.SubscriptionManager" parent="txProxyTemplate">
        <property name="target">
            <bean class="org.jahia.hibernate.manager.SubscriptionManager">
                <property name="subscriptionDAO" ref="jahiaSubscriptionDAO" />
            </bean>
        </property>
    </bean>
    
</beans>