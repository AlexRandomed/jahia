<?xml version="1.0" encoding="ISO-8859-1"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
    <bean id="MailService" parent="proxyTemplate">
        <property name="target">
            <bean class="org.jahia.services.mail.MailServiceImpl" parent="jahiaServiceTemplate">
                <property name="backgroundTaskPeriod" value="10000"/>
                <property name="mailQueueMaxLength" value="1000"/>
            </bean>
        </property>
    </bean>
    
    <bean id="SubscriptionService" parent="proxyTemplate">
        <property name="target">
            <bean class="org.jahia.services.notification.SubscriptionService" parent="jahiaServiceTemplate" factory-method="getInstance">
                <property name="subscriptionManager" ref="org.jahia.hibernate.manager.SubscriptionManager"/>
                <property name="mailService" ref="MailService"/>
            </bean>
        </property>
    </bean>

    <bean id="EmailNotificationEventHandlerTemplate" class="org.jahia.services.notification.EmailNotificationEventHandler" abstract="true">
        <property name="mailService" ref="MailService"/>
    </bean>

    <bean id="NotificationService" parent="proxyTemplate">
        <property name="target">
            <bean class="org.jahia.services.notification.NotificationService" parent="jahiaServiceTemplate" factory-method="getInstance">
                <property name="subscriptionService" ref="SubscriptionService"/>
                <property name="handlers">
                    <list/>
                </property>
            </bean>
        </property>
    </bean>

    <bean id="HttpClient" class="org.apache.commons.httpclient.HttpClient" destroy-method="">
        <constructor-arg index="0">
            <bean
                class="org.apache.commons.httpclient.MultiThreadedHttpConnectionManager"
                scope="prototype">
                <property name="params">
                    <bean
                        class="org.apache.commons.httpclient.params.HttpConnectionManagerParams">
                        <property name="connectionTimeout" value="10000" />
                        <property name="soTimeout" value="15000" />
                    </bean>
                </property>
            </bean>
        </constructor-arg>
    </bean>

    <bean id="HttpClientService" class="org.jahia.services.notification.HttpClientService" destroy-method="shutdown">
        <property name="httpClient" ref="HttpClient"/>
    </bean>

    <bean id="HtmlExternalizationService" class="org.jahia.services.notification.HtmlExternalizationService">
        <property name="urlTraverser"
            ref="org.jahia.services.render.filter.URLTraverser" />
        <property name="httpClientService" ref="HttpClientService" />
        <property name="useServletContextResources" value="true" />
        <property name="rewriteUrls" value="true"/>
        <property name="inlineCss" value="true"/>
        <property name="rewriteUrlsInCss" value="true"/>
        <property name="removeExternalScripts" value="true"/>
        <property name="removeInlinedScripts" value="true"/>
    </bean>
</beans>