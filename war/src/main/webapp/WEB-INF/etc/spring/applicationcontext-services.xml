<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

    <bean class="org.jahia.services.SpringContextSingleton" factory-method="getInstance"/>

    <bean id="jahiaServiceTemplate" class="org.jahia.services.JahiaService" abstract="true" init-method="start"
          destroy-method="stop">
        <property name="settingsBean" ref="settingsBean"/>
    </bean>

    <bean id="JahiaPreferencesService" class="org.jahia.services.preferences.JahiaPreferencesService"
          parent="jahiaServiceTemplate" factory-method="getInstance">
        <property name="cacheService" ref="JahiaCacheService"/>
        <property name="jcrStoreService" ref="JCRStoreService"/>
        <property name="providerTypes">
            <map>
                <entry key="simple" value="jnt:simplePreference"/>
                <entry key="page" value="jnt:pagePreference"/>
                <entry key="portlet" value="jnt:portletPreference"/>
                <entry key="layoutmanager" value="jnt:layout"/>
                <entry key="bookmarks" value="jnt:bookmarkPreference"/>
            </map>
        </property>
    </bean>
    <bean id="PortletDispatchingProvider" class="org.jahia.services.applications.pluto.PlutoDispatchingProvider"
          init-method="start" destroy-method="stop"/>
	<bean id="DispatchingService" class="org.jahia.services.applications.DispatchingServiceImpl"
		parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="dispatchingProviders">
			<map>
				<entry key="portlet" value-ref="PortletDispatchingProvider" />
			</map>
		</property>
		<property name="applicationsManager" ref="ApplicationsManagerService" />
	</bean>
    <bean id="ServletContextManager" class="org.jahia.services.applications.ServletContextManager"
          factory-method="getInstance" init-method="start">
        <property name="cacheService" ref="JahiaCacheService"/>
    </bean>
	<bean id="QueryService" class="org.jahia.services.query.QueryServiceImpl"
		parent="jahiaServiceTemplate" factory-method="getInstance" />
    <bean id="ApplicationsManagerPortletProvider"
          class="org.jahia.services.applications.pluto.ApplicationsManagerPlutoProvider" init-method="start"
          destroy-method="stop"/>
	<bean id="ApplicationsManagerService"
		class="org.jahia.services.applications.ApplicationsManagerServiceImpl"
		parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="managerProviders">
			<map>
				<entry key="portlet" value-ref="ApplicationsManagerPortletProvider" />
			</map>
		</property>
		<property name="jcrTemplate" ref="jcrTemplate" />
		<property name="cacheService" ref="JahiaCacheService" />
		<property name="groupManagerService" ref="JahiaGroupManagerService" />
		<property name="servletContextManager" ref="ServletContextManager" />
		<property name="plutoServices" ref="PlutoServices" />
	</bean>
    <bean id="JahiaFetcherService" class="org.jahia.services.fetchers.JahiaFetcherBaseService" parent="jahiaServiceTemplate"
                  factory-method="getInstance"/>
	<bean id="JahiaFileWatcherService"
		class="org.jahia.services.deamons.filewatcher.JahiaFileWatcherBaseService"
		parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="schedulerService" ref="SchedulerService" />
	</bean>
    <bean id="JahiaSitesService" class="org.jahia.services.sites.JahiaSitesBaseService" parent="jahiaServiceTemplate"
          factory-method="getInstance" lazy-init="true">
        <property name="groupService" ref="JahiaGroupManagerService"/>
        <property name="cacheService" ref="JahiaCacheService"/>
        <property name="siteProvider">
            <bean class="org.jahia.services.sites.jcr.JCRSitesProvider">
                <property name="jcrTemplate" ref="jcrTemplate"/>
            </bean>
        </property>
        <property name="sessionFactory" ref="jcrSessionFactory"/>
        <property name="systemSiteTitle" value="System Site"/>
        <property name="systemSiteServername" value="localhost"/>
        <property name="systemSiteDefaultLanguage" value="en"/>
        <property name="systemSiteTemplateSetName" value="templates-system"/>
    </bean>

	<bean id="CategoryService" class="org.jahia.services.categories.CategoryServiceImpl"
		parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="categoryProvider"
			ref="org.jahia.services.categories.jcr.JCRCategoryProvider" />
	</bean>
    
    <bean id="org.jahia.services.categories.jcr.JCRCategoryProvider" class="org.jahia.services.categories.jcr.JCRCategoryProvider">
		<property name="sessionFactory" ref="jcrSessionFactory"/>
    </bean>
    
    <bean id="org.jahia.services.tags.TaggingService" class="org.jahia.services.tags.TaggingService"/>

	<bean id="ImportExportService" class="org.jahia.services.importexport.ImportExportBaseService" parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="sitesService" ref="JahiaSitesService" />
		<property name="jcrStoreService" ref="JCRStoreService" />
		<property name="fileWatcherService" ref="JahiaFileWatcherService" />
		<property name="categoryService" ref="CategoryService" />
	</bean>

    <bean id="org.jahia.services.templates.TemplatePackageRegistry"
          class="org.jahia.services.templates.TemplatePackageRegistry">
        <property name="settingsBean" ref="settingsBean"/>
    </bean>

    <bean id="JahiaTemplateManagerService" class="org.jahia.services.templates.JahiaTemplateManagerService"
          parent="jahiaServiceTemplate">
        <property name="templatePackageDeployer">
            <bean class="org.jahia.services.templates.TemplatePackageDeployer">
                <property name="settingsBean" ref="settingsBean"/>
                <property name="templatePackageRegistry" ref="org.jahia.services.templates.TemplatePackageRegistry"/>
                <property name="importExportService" ref="ImportExportService"/>
                <property name="contextLoader" ref="TemplatePackageApplicationContextLoader"/>
            </bean>
        </property>
        <property name="siteService" ref="JahiaSitesService"/>
        <property name="templatePackageRegistry" ref="org.jahia.services.templates.TemplatePackageRegistry"/>
    </bean>

    <bean id="TemplatePackageApplicationContextLoader"
          class="org.jahia.services.templates.TemplatePackageApplicationContextLoader">
        <property name="contextConfigLocation" value="modules/**/META-INF/spring/*.xml"/>
    </bean>

	<bean id="org.jahia.services.tasks.TaskService" class="org.jahia.services.tasks.TaskService">
		<property name="groupManager" ref="JahiaGroupManagerService" />
	</bean>

	<bean id="SearchService" class="org.jahia.services.search.SearchServiceImpl"
		parent="jahiaServiceTemplate" factory-method="getInstance">
		<property name="searchProvider"
			ref="org.jahia.services.search.jcr.JahiaJCRSearchProvider" />
	</bean>

    <bean id="org.jahia.services.search.jcr.JahiaJCRSearchProvider"
          class="org.jahia.services.search.jcr.JahiaJCRSearchProvider">
        <property name="taggingService" ref="org.jahia.services.tags.TaggingService"/>
    </bean>


    <bean id="GoogleAnalyticsService" class="org.jahia.services.analytics.GoogleAnalyticsService"
          factory-method="getInstance"/>

    <bean id="org.jahia.services.seo.jcr.VanityUrlManager" class="org.jahia.services.seo.jcr.VanityUrlManager"/>
    <bean id="org.jahia.services.seo.jcr.VanityUrlService" class="org.jahia.services.seo.jcr.VanityUrlService">
        <property name="vanityUrlManager" ref="org.jahia.services.seo.jcr.VanityUrlManager"/>
    </bean>

    <bean id="ContentHistoryService" class="org.jahia.services.history.ContentHistoryService"
          init-method="start" factory-method="getInstance">
        <property name="sessionFactoryBean" ref="sessionFactory"/>
        <property name="from" value="seda:logMsgs"/>
        <property name="ignoreProperties">
            <set>
                <value>jcr:created</value>
                <value>jcr:createdBy</value>
                <value>jcr:lastModifiedBy</value>
                <value>jcr:baseVersion</value>
                <value>jcr:lastModified</value>
                <value>jcr:versionHistory</value>
                <value>jcr:predecessors</value>
                <value>jcr:isCheckedOut</value>
                <value>jcr:mimeType</value>
                <value>jcr:data</value>
                <value>jcr:uuid</value>
                <value>jcr:primaryType</value>
                <value>jcr:mixinTypes</value>
                <value>jcr:language</value>
                <value>j:hidden</value>
                <value>j:inherit</value>
                <value>j:userView</value>
                <value>j:aceType</value>
                <value>j:nodename</value>
                <value>j:fullpath</value>
                <value>j:originWS</value>
                <value>j:privileges</value>
                <value>j:principal</value>
                <value>j:protected</value>
                <value>j:external</value>
                <value>j:password</value>
                <value>j:accountLocked</value>
                <value>j:lockTypes</value>
                <value>j:locktoken</value>
                <value>j:published</value>
            </set>
        </property>
        <property name="ignoreNodeTypes">
            <set>
                <value>jnt:usersFolder</value>
                <value>jnt:groupsFolder</value>
            </set>
        </property>
    </bean>

</beans>
