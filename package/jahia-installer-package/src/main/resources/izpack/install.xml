<?xml version="1.0" encoding="UTF-8"?>
<installation version="1.0">
    <info>
        <appname>${product.name}</appname>
        <appversion>${jahia.package.version}</appversion>
        <authors>
            <author email="${jahia.manifest.vendor.email}" name="${jahia.manifest.vendor.name}"/>
        </authors>
        <url>${jahia.manifest.vendor.url}</url>
        <uninstaller name="uninstaller.jar" write="yes"/>
        <javaversion>1.5</javaversion>
        <requiresjdk>no</requiresjdk>
        <writeinstallationinformation>no</writeinstallationinformation>
        <run-privileged condition="izpack.windowsinstall.vista|izpack.windowsinstall.7"/>
    </info>
    <variables>
        <variable name="product.name" value="${product.name}"/>
        <variable name="product.version" value="${jahia.package.version}"/>
    </variables>
    <dynamicvariables>
        <variable name="jahia.war.contextPath" value=""/>
        <variable name="jahia.war.target.path" value="$INSTALL_PATH/tomcat/webapps/ROOT" condition="cnd.pack.tomcat"/>
        <variable name="jahia.war.target.path" value="$INSTALL_PATH/build" condition="!cnd.pack.tomcat"/>

        <variable name="jahia.war.excludes" value="" condition="!cnd.server.type.jboss"/>
        <variable name="jahia.war.excludes" value="**/WEB-INF/lib/jboss-j2ee-*.jar,**/WEB-INF/lib/jstl-*.jar,**/WEB-INF/lib/standard-*.jar,**/WEB-INF/lib/ojdbc5-*.jar,**/WEB-INF/lib/orai18n-*.jar,**/WEB-INF/lib/sqljdbc-*.jar,**/WEB-INF/lib/mysql-connector-java-*.jar,**/WEB-INF/lib/derby-*.jar,**/WEB-INF/lib/derbyclient-*.jar,**/WEB-INF/lib/postgresql-*.jar" condition="cnd.server.type.jboss"/>
        
        <variable name="server.type" value="tomcat" condition="cnd.pack.tomcat"/>

        <!-- embedded Derby defaults -->
        <variable name="dbSettings.dbms.type" value="derby_embedded" condition="cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.dbms.createTables" value="true" condition="cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.driver" value="org.apache.derby.jdbc.EmbeddedDriver" condition="cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.url" value="jdbc:derby:directory:$context/WEB-INF/var/dbdata/jahia;create=true" condition="cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.username" value="" condition="cnd.db.dbms.derby_embedded"/>
        <variable name="dbSettings.connection.password" value="" condition="cnd.db.dbms.derby_embedded"/>
        
        <variable name="var.db.driver" value="com.microsoft.sqlserver.jdbc.SQLServerDriver" condition="cnd.db.dbms.mssql" />
        <variable name="var.db.driver" value="com.mysql.jdbc.Driver" condition="cnd.db.dbms.mysql_innodb" />
        <variable name="var.db.driver" value="com.mysql.jdbc.Driver" condition="cnd.db.dbms.mysql" />
        <variable name="var.db.driver" value="oracle.jdbc.OracleDriver" condition="cnd.db.dbms.oracle" />
        <variable name="var.db.driver" value="oracle.jdbc.OracleDriver" condition="cnd.db.dbms.oracle_legacy" />
        <variable name="var.db.driver" value="org.postgresql.Driver" condition="cnd.db.dbms.postgresql" />
        <variable name="var.db.driver" value="org.apache.derby.jdbc.ClientDriver" condition="cnd.db.dbms.derby" />

        <variable name="var.db.url" value="jdbc:sqlserver://localhost;databaseName=jahia" condition="cnd.db.dbms.mssql" />
        <variable name="var.db.url" value="jdbc:mysql://localhost/jahia?useUnicode=true&amp;characterEncoding=UTF-8&amp;useServerPrepStmts=false" condition="cnd.db.dbms.mysql_innodb" />
        <variable name="var.db.url" value="jdbc:mysql://localhost/jahia?useUnicode=true&amp;characterEncoding=UTF-8&amp;useServerPrepStmts=false" condition="cnd.db.dbms.mysql" />
        <variable name="var.db.url" value="jdbc:oracle:thin:@localhost:1521:jahia" condition="cnd.db.dbms.oracle" />
        <variable name="var.db.url" value="jdbc:oracle:thin:@localhost:1521:jahia" condition="cnd.db.dbms.oracle_legacy" />
        <variable name="var.db.url" value="jdbc:postgresql://localhost:5432/jahia" condition="cnd.db.dbms.postgresql" />
        <variable name="var.db.url" value="jdbc:derby://localhost:1527/jahia;create=true" condition="cnd.db.dbms.derby" />
    </dynamicvariables>
    
    <conditions>
        <condition type="packselection" id="cnd.pack.tomcat">
            <packid>tomcat</packid>
        </condition>
        
        <condition type="variable" id="cnd.server.type.jboss">
            <name>server.type</name>
            <value>jboss</value>
        </condition>
        
        <condition type="or" id="cnd.skip.shared.libs">
            <condition type="ref" refid="cnd.pack.tomcat"/>
            <condition type="ref" refid="cnd.server.type.jboss"/>
        </condition>
        
        <condition type="variable" id="cnd.db.mode.standalone">
            <name>dbSettings.mode</name>
            <value>standalone</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.derby_embedded">
            <name>dbSettings.mode</name>
            <value>embedded</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.mssql">
            <name>dbSettings.dbms.type</name>
            <value>mssql</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.mysql_innodb">
            <name>dbSettings.dbms.type</name>
            <value>mysql_innodb</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.mysql">
            <name>dbSettings.dbms.type</name>
            <value>mysql</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.oracle">
            <name>dbSettings.dbms.type</name>
            <value>oracle</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.oracle_legacy">
            <name>dbSettings.dbms.type</name>
            <value>oracle_legacy</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.postgresql">
            <name>dbSettings.dbms.type</name>
            <value>postgresql</value>
        </condition>
        <condition type="variable" id="cnd.db.dbms.derby">
            <name>dbSettings.dbms.type</name>
            <value>derby</value>
        </condition>
    </conditions>
    <guiprefs height="480" resizable="yes" width="640">
        <modifier key="useFlags" value="yes"/>
        <modifier key="langDisplayType" value="native"/>
        <modifier key="useHeadingPanel" value="yes"/>
        <modifier key="headingImageOnLeft" value="yes"/>
        <modifier key="headingFontSize" value="2"/>
        <modifier key="headingBackgroundColor" value="-65794"/>
        <modifier key="headingForegroundColor" value="-1"/>
        <modifier key="headingPanelCounter" value="progressbar"/>
        <modifier key="headingPanelCounterPos" value="inNavigationPanel"/>
    </guiprefs>
    <locale>
        <langpack iso3="eng"/>
        <langpack iso3="fra"/>
        <langpack iso3="deu"/>
        <langpack iso3="ita"/>
        <langpack iso3="por"/>
        <langpack iso3="spa"/>
    </locale>
    <resources>
        <res id="TargetPanel.dir.unix" src="unix-path.txt" />
        <res id="TargetPanel.dir.windows" src="windows-path.txt" />
        <res id="installer.langsel.img" src="../images/jahia-community.png"/>
        <res id="Heading.image" src="../images/top-logo.gif.png"/>
        <res id="LicencePanel.licence" parse="no" src="../licenses/license.txt"/>

        <res id="ProcessPanel.Spec.xml" src="ProcessPanel.Spec.xml"/>

        <res id="shortcutSpec.xml" src="windows-shortcuts.xml"/>
        <!-- 
        <res id="Unix_shortcutSpec.xml" src="unix-shortcuts.xml"/>
         -->
        <res id="userInputSpec.xml" src="userInputSpec.xml"/>
        <res id="userInputLang.xml_eng" src="i18n/userInputLang.eng.xml" />
        <res id="userInputLang.xml_fra" src="i18n/userInputLang.fra.xml" />
        <res id="userInputLang.xml_deu" src="i18n/userInputLang.deu.xml" />
        <res id="userInputLang.xml_ita" src="i18n/userInputLang.ita.xml" />
        <res id="userInputLang.xml_por" src="i18n/userInputLang.por.xml" />
        <res id="userInputLang.xml_spa" src="i18n/userInputLang.spa.xml" />

        <res id="packsLang.xml_eng" src="i18n/packsLang.eng.xml"/>
        <res id="packsLang.xml_fra" src="i18n/packsLang.fra.xml"/>
        <res id="packsLang.xml_deu" src="i18n/packsLang.deu.xml"/>
        <res id="packsLang.xml_ita" src="i18n/packsLang.ita.xml"/>
        <res id="packsLang.xml_por" src="i18n/packsLang.por.xml"/>
        <res id="packsLang.xml_spa" src="i18n/packsLang.spa.xml"/>

        <res id="CustomLangpack.xml_eng" src="i18n/customLang.eng.xml"/>
        <res id="CustomLangpack.xml_fra" src="i18n/customLang.fra.xml"/>
        <res id="CustomLangpack.xml_deu" src="i18n/customLang.deu.xml"/>
        <res id="CustomLangpack.xml_ita" src="i18n/customLang.ita.xml"/>
        <res id="CustomLangpack.xml_por" src="i18n/customLang.por.xml"/>
        <res id="CustomLangpack.xml_spa" src="i18n/customLang.spa.xml"/>
    </resources>
    <panels>
        <panel classname="CheckedHelloPanel"/>
        <panel classname="LicencePanel"/>
        <panel classname="PacksPanel" id="packsPanel"/>
        <panel classname="TargetPanel"/>
        <panel classname="UserInputPanel" condition="!cnd.pack.tomcat" id="serverType"/>
        <panel classname="UserInputPanel" id="dbMode"/>
        <panel classname="UserInputPanel" condition="cnd.db.mode.standalone" id="dbmsType"/>
        <panel classname="UserInputPanel" condition="cnd.db.mode.standalone" id="connectionManual"/>
        <panel classname="UserInputPanel" id="superUser"/>
        <panel classname="UserInputPanel" id="mailSettings"/>
        <panel classname="ShortcutPanel" id="shortcutPanel"/>
        <panel classname="SummaryPanel"/>
        <panel classname="InstallPanel"/>
        <!-- 
        <panel classname="ProcessPanel"/>
        -->
        <panel classname="SimpleFinishPanel"/>
    </panels>
    
    <native type="izpack" name="ShellLink.dll" />
    <native name="ShellLink.dll" type="izpack">
        <os family="windows" />
    </native>
    <native name="COIOSHelper.dll" stage="both" type="3rdparty">
        <os family="windows" />
    </native>
    
    <listeners>
        <listener installer="RegistryInstallerListener" uninstaller="RegistryUninstallerListener">
            <os family="windows" />
        </listener>
    </listeners>
     
    <packs>
        <pack name="Jahia Core" id="core" preselected="yes" required="yes">
            <description/>
            <fileset dir="../licenses" targetdir="$INSTALL_PATH/licenses" />
            <fileset dir="../links" targetdir="$INSTALL_PATH/bin" />
            <fileset dir="../artifacts/jahia" targetdir="${jahia.war.target.path}" />
            <fileset dir="../artifacts/jahia-jboss-config" targetdir="$INSTALL_PATH/jahia-jboss-config" condition="cnd.server.type.jboss"/>
            <singlefile override="update" src="install.properties" target="$INSTALL_PATH/install.properties"/>
            <singlefile override="update" src="../dependency/configurators-${configurators.version}-standalone.jar" target="$INSTALL_PATH/configurators.jar"/>
            <singlefile override="update" src="../dependency/archivers-${archivers.version}-standalone.jar" target="$INSTALL_PATH/archivers.jar" condition="!cnd.pack.tomcat"/>
            <singlefile override="update" src="../artifacts/shared-libraries-all.zip" target="$INSTALL_PATH/shared-libraries.zip" condition="!cnd.skip.shared.libs"/>
            <parsable targetfile="$INSTALL_PATH/install.properties" type="javaprop"/>
            <executable targetfile="$INSTALL_PATH/configurators.jar" stage="postinstall" type="jar" keep="false">
                <args>
                    <arg value="$INSTALL_PATH/install.properties"/>
                </args>
            </executable>
            <executable targetfile="$INSTALL_PATH/archivers.jar" stage="postinstall" type="jar" keep="true" condition="cnd.server.type.jboss">
                <args>
                    <arg value="-m"/><!-- delete the build folder after archiving -->
                    <arg value="$INSTALL_PATH/jahia-jboss-config.sar"/>
                    <arg value="$INSTALL_PATH/jahia-jboss-config"/>
                </args>
            </executable>
            <executable targetfile="$INSTALL_PATH/archivers.jar" stage="postinstall" type="jar" keep="false" condition="!cnd.pack.tomcat">
                <args>
                    <arg value="-m"/><!-- delete the build folder after archiving -->
                    <arg value="$INSTALL_PATH/ROOT.war"/>
                    <arg value="$INSTALL_PATH/build"/>
                    <arg value="${jahia.war.excludes}"/>
                </args>
            </executable>
        </pack>
        <pack name="Apache Tomcat" id="tomcat" preselected="yes" required="no">
            <description/>
            <fileset dir="../artifacts/apache-tomcat-6.0.24" targetdir="$INSTALL_PATH/tomcat" />
            <file override="update" src="../artifacts/shared-libraries-all.zip" targetdir="$INSTALL_PATH/tomcat/lib" unpack="true"/>
            <fileset dir="../tomcat" targetdir="$INSTALL_PATH/tomcat" override="update" />
            <fileset dir="../scripts" targetdir="$INSTALL_PATH" override="update" condition="izpack.windowsinstall">
                <include name="st*.bat"/>
            </fileset>
            <fileset dir="../scripts" targetdir="$INSTALL_PATH" override="update" condition="!izpack.windowsinstall">
                <include name="st*.sh"/>
            </fileset>
            <fileset dir="../images" targetdir="$INSTALL_PATH/bin" override="update">
                <include name="st*.ico"/>
            </fileset>
            <parsable targetfile="$INSTALL_PATH/startJahia.bat" type="shell" os="windows"/>
            <parsable targetfile="$INSTALL_PATH/startJahia.sh" type="shell" os="unix" />
            <parsable targetfile="$INSTALL_PATH/startJahia.sh" type="shell" os="mac" />
            <parsable targetfile="$INSTALL_PATH/stopJahia.bat" type="shell" os="windows"/>
            <parsable targetfile="$INSTALL_PATH/stopJahia.sh" type="shell" os="unix"/>
            <parsable targetfile="$INSTALL_PATH/stopJahia.sh" type="shell" os="mac"/>
            <executable targetfile="$INSTALL_PATH/tomcat/bin/catalina.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/digest.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/setclasspath.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/shutdown.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/startup.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/tool-wrapper.sh" />
            <executable targetfile="$INSTALL_PATH/tomcat/bin/version.sh" />
            <executable targetfile="$INSTALL_PATH/startJahia.sh" />
            <executable targetfile="$INSTALL_PATH/stopJahia.sh" />
        </pack>
        <pack name="TODO: Jahia Unified Content Hub" id="juch" preselected="no" required="no">
            <description/>
        </pack>
        <pack name="TODO: Jahia Documentation" id="docs" preselected="no" required="no">
            <description/>
        </pack>
    </packs>

</installation>
